<template>
    <div ref="Chart" style="height: 400px;"></div>
</template>

<style lang="scss">

</style>

<script>
import { topo } from "@/api/chart";
export default {
  props: ["info"],
  data() {
    return {
      mndata: [],
      option: "",
      zuob:""
    };
  },
  mounted() {
    topo(this.info[0]).then(result => {
      let self = this;
      result.data.forEach(function(stro) {
        self.mndata.push(stro.gateway_id);
      });
      this.getCharts();
    });
  },
  watch: {
    info: function() {
      this.mndata.splice(0, this.mndata.length);
      topo(this.info[0]).then(result => {
        let self = this;
        result.data.forEach(function(stro) {
          self.mndata.push(stro.gateway_id);
        });
        this.change();
      });
    }
  },
  methods: {
    getCharts() {
      let chart = this.$refs.Chart;
      let myChart = this.$echarts.init(chart);
      let self = this;
      let zuob = "";

      let metac =
        "path://M396.333 99.403c71.204-10.074 143.764-10.534 215.098-1.425 53.461 6.989 106.546 19.287 156.341 40.261 29.004 12.392 57.078 27.788 81.009 48.517 27.431 23.214 49.172 57.191 46.14 94.438-0.067 57.382 0.128 114.762-0.093 172.141-15.844-13.598-32.74-25.963-50.579-36.83-0.428-17.804 0.101-35.629-0.233-53.43-14.722 11.094-29.964 21.628-46.455 29.943-2.261 1.253-4.705-0.2-6.907-0.837-24.282-8.782-49.808-13.523-75.415-16.234 30.615-10.364 61.494-21.79 87.991-40.784 20.272-14.466 40.209-35.155 40.86-61.557 0.323-26.451-19.265-47.645-39.397-62.265-25.259-18.239-54.408-30.223-83.904-39.715-57.367-17.951-117.42-26.076-177.344-28.642-66.183-2.504-132.833 1.976-197.652 15.89-51.793 12.001-105.522 27.98-146.092 63.956-13.238 12.361-24.477 28.639-25.391 47.279-1.279 24.222 15.134 44.878 33.094 59.203 24.519 19.537 53.676 32.192 83.148 42.233 88.446 28.786 182.77 34.908 275.164 30.007-27.818 13.047-54.266 29.391-77.183 49.979-2.377 2.762-6.182 2.011-9.382 1.922-62.408-2.496-124.838-11.449-184.551-30.122-42.93-13.472-84.713-32.343-120.271-60.253-0.221 20.978-0.036 41.961-0.094 62.939-0.068 16.448 8.28 31.66 19.171 43.5 15.69 17 35.848 29.132 56.528 39.109 51.466 24.085 107.799 35.349 163.818 42.632-7.214 15.406-12.896 31.471-17.735 47.773-78.302-11.336-158.109-33.706-221.69-82.67-0.197 20.991-0.086 41.997-0.051 62.989 0.48 16.234 9.050 31.048 19.941 42.632 15.592 16.549 35.392 28.431 55.717 38.237 42.765 20.121 89.164 31.037 135.593 38.752 1.177 17.25 3.961 34.335 7.341 51.269-77.21-11.676-155.843-33.9-218.544-82.287-0.218 20.425-0.031 40.851-0.094 61.278 0.629 18.322 11.3 34.585 24.18 46.917 18.732 17.862 41.931 30.241 65.616 40.226 55.311 22.73 114.827 33.262 174.132 38.616 2.423 0.162 3.481 2.678 4.846 4.319 12.594 18.049 27.981 33.877 43.717 49.129-65.167-1.946-130.445-10.993-192.769-30.539-47.338-15.235-94.341-36.133-131.034-70.502-21.106-20.019-38.323-46.62-39.423-76.452-0.178-152.157-0.017-304.351-0.084-456.521-0.711-30.219 15.593-57.997 36.51-78.677 20.264-20.17 44.767-35.551 70.273-48.208 52.149-25.342 108.967-39.756 166.138-48.129h0.005zM674.236 426.416c57.102-3.405 115.166 13.382 161.599 46.815 43.343 30.882 76.457 75.854 92.951 126.461 19.504 58.424 16.405 123.967-8.434 180.324-21.62 49.855-59.907 92.239-107.264 118.865-54.683 31.138-121.212 40.635-182.408 25.948-50.536-11.779-97.131-39.674-131.401-78.63-38.573-43.385-61.321-100.451-63.194-158.467-2.301-59.369 17.344-119.247 54.327-165.744 43.947-56.139 112.62-91.85 183.823-95.578M541.869 553.129c-0.161 16.868-0.161 33.758 0 50.626 16.868 0.16 33.757 0.16 50.625 0 0.162-16.868 0.162-33.758 0-50.626-16.868-0.159-33.757-0.159-50.625 0M643.492 553.129c-0.161 16.868-0.161 33.758 0 50.626 67.684 0.16 135.38 0.154 203.063 0 0.161-16.868 0.161-33.758 0-50.626-67.684-0.151-135.38-0.159-203.063 0M541.869 653.908c-0.161 16.868-0.17 33.755 0.008 50.622 16.86 0.164 33.749 0.164 50.621 0 0.157-16.867 0.157-33.755 0-50.622-16.872-0.171-33.758-0.162-50.63 0M643.492 653.908c-0.161 16.868-0.161 33.755 0 50.622 67.684 0.156 135.38 0.164 203.063 0 0.161-16.867 0.161-33.755 0-50.622-67.684-0.154-135.38-0.154-203.063 0M541.869 756.382c-0.161 16.868-0.161 33.757 0 50.624 16.868 0.162 33.757 0.162 50.625 0 0.162-16.868 0.162-33.757 0-50.624-16.868-0.162-33.757-0.162-50.625 0M643.492 756.382c-0.161 16.868-0.161 33.757 0 50.624 67.684 0.154 135.38 0.162 203.063 0 0.161-16.868 0.161-33.757 0-50.624-67.684-0.154-135.38-0.162-203.063 0v0zM643.492 756.382z";
      let nodec =
        "path://M930.3 753.9H611.6c-11.2-33.5-39.3-61.7-72.8-72.8v-42h279.8c44.7 0 84-39.3 84-84v-55.9c-0.4-44.7-39.3-84-84-84H204.1c-44.7 0-84 39.3-84 84V555c0 44.7 39.3 84 84 84h279.3v37.1c-33.5 11.2-61.7 39.3-72.8 72.8H92.3c-17 0-28.2 11.2-28.2 28.2s11.2 28.2 28.2 28.2H411c11.2 44.7 50.5 78.2 100.6 78.2 50.1 0 89.4-33.5 100.6-78.2h318.6c17 0 28.2-11.2 28.2-28.2s-12.2-23.2-28.7-23.2zM175.9 555v-55.9c0-17 11.2-28.2 28.2-28.2h614.5c17 0 28.2 11.2 28.2 28.2V555h-0.4c0 17-11.2 28.2-28.2 28.2h-614c-17.1 0-28.3-11.2-28.3-28.2z m335.2 277.1c-28.2 0-50.5-22.3-50.5-50.5s22.3-50.5 50.5-50.5 50.5 22.3 50.5 50.5c0 28.1-22.4 50.5-50.5 50.5z m301.6-304.8c0 21.5-17.9 38.9-39.3 38.9-21.5 0-38.9-17.9-38.9-39.3s17.4-39.3 39.3-38.9c21.5 0 38.9 17.9 38.9 39.3zM204.1 370.4h614.5c44.7 0 84-39.3 84-84V231c-0.4-50.5-39.3-84-84-84H204.1c-44.7 0-84 33.5-84 83.6v55.9c0 44.6 39.3 83.9 84 83.9zM175.9 231c0-17 11.2-28.2 28.2-28.2h614.5c17 0 28.2 11.2 28.2 28.2-0.4 0-0.4 55.9-0.4 55.9 0 17-11.2 28.2-28.2 28.2h-614c-17 0-28.2-11.2-28.2-28.2V231z m558.6 27.7c0-21.5 17.9-38.9 39.3-38.9 21.5 0 38.9 17.9 38.9 39.3 0 21.5-17.9 38.9-39.3 38.9-21.4 0.1-38.9-17.8-38.9-39.3z";

      zuob = [{ symbol: metac, name: self.info[1], x: 500, y: 0 }];
      let relation = [];

      this.cpt = function(val, z) {
        let base = 1000 / (self.mndata.length - 1);

        let node = {
          symbol: nodec,
          name: val,
          y: 200,
          x: base * z
        };
        let line = {
          symbol: "circle",
          source: 0,
          target: z + 1
        };
        zuob.push(node);
        relation.push(line);
      };
      this.mndata.forEach(this.cpt);

      this.option = {
        tooltip: {
          trigger: "item"
        },
        series: [
          {
            type: "graph",
            symbolSize: 50,
            label: {
              normal: {
                show: true,
                position: "top",
                fontSize: "16"
              }  
            },
            data: zuob,
            links: relation,
            lineStyle: {
              normal: {
                opacity: 0.8,
                width: 1.6
              }
            }
          }
        ]
      };

      myChart.setOption(this.option, true);

      this.change = function() {
        zuob.splice(0, zuob.length);
        zuob = [{ symbol: metac, name: self.info[1], x: 500, y: 0 }];
        relation.splice(0, relation.length);
        this.mndata.forEach(this.cpt);
        myChart.setOption({
          series: [
            {
              data: zuob,
              links: relation
            }
          ]
        });
      };
    }
  }
};
</script>


