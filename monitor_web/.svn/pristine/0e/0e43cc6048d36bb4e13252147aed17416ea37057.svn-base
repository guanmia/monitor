webpackJsonp([22],{"e+ax":function(e,t){},"i/Eh":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("viKb"),r=(a("0xDb"),a("vMJZ")),i={name:"user",components:{},data:function(){return{list:null,total:null,dataForm:{id:null,username:"",password:"",email:"",phone:"",roles:["user"],introduction:""},visible:!1,editId:0,operate:0,loading:!0,detailVisible:!1,detailTitle:"",detail:"",saveLoading:!1,currentTableLists:[],search:"",listQuery:{searchkeys:{username:[]},page:1,limit:10},rules:{username:[{required:!0,message:this.$t("user.usernameMsg"),trigger:"blur"},{validator:s.a.usernameRule,trigger:"blur"}],password:[{required:!0,message:this.$t("user.passwordMsg"),trigger:"blur"}],email:[{required:!0,message:this.$t("user.emailMsg"),trigger:"blur"},{validator:s.a.emailRule,trigger:"blur"}],phone:[{required:!0,message:this.$t("user.phoneMsg"),trigger:"blur"},{validator:s.a.phoneRule,trigger:"blur"}]}}},filters:{rolesFilter:function(e){return{admin:"warning",user:"info"}[e]}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,Object(r.e)({page:1,limit:1e3}).then(function(t){0===t.error_code&&(e.list=t.data.results,e.total=t.data.total,e.tableListsChange())})},handleFilter:function(){this.listQuery.page=1,this.tableListsChange()},handleSizeChange:function(e){this.listQuery.limit=e,this.tableListsChange()},handleCurrentChange:function(e){this.listQuery.page=e,this.tableListsChange()},tableListsChange:function(){var e=this,t=this.search.replace(" ","|"),a=new RegExp(t);this.currentTableLists=this.list.filter(function(t,s,r){return s>=e.listQuery.limit*(e.listQuery.page-1)&&s<e.listQuery.limit*e.listQuery.page&&a.test(t.username)}),this.loading=!1},handleCreate:function(){this.visible=!0,this.operate=0},editRow:function(e){var t=this;this.editId=e,Object(r.d)({id:e}).then(function(e){0===e.error_code&&(t.dataForm=e.data,t.operate=1,t.visible=!0)})},saveForm:function(){var e=this;this.$refs.dataForm.validate(function(t){if("admin"===e.dataForm.username)e.$message.warning({message:e.$t("user.userNote"),center:!0});else if(t){e.saveLoading=!0;var a=e.dataForm.roles;a=(a=a.join(",")).replace("admin","ROLE_ADMIN"),e.dataForm.roles=a.replace("user","ROLE_USER"),0===e.operate?(e.dataForm.id=null,Object(r.b)(e.dataForm).then(function(t){0===t.error_code&&(e.$notify({title:e.$t("table.success"),message:e.$t("table.createSuccess"),type:"success",duration:2e3}),e.getList(),e.resetForm())})):1===e.operate&&(e.dataForm.password=null,Object(r.i)(e.dataForm).then(function(t){0===t.error_code&&(e.$notify({title:e.$t("table.success"),message:e.$t("table.updateSuccess"),type:"success",duration:2e3}),e.getList(),e.resetForm())}))}})},deleteRow:function(e){var t=this;this.$confirm(this.$t("table.deleteNote"),this.$t("table.note"),{confirmButtonText:this.$t("table.delete"),cancelButtonText:this.$t("table.cancel"),type:"warning"}).then(function(){Object(r.c)({id:e}).then(function(e){0===e.error_code&&(console.log(e),t.$notify({title:t.$t("table.success"),message:t.$t("table.deleteSuccess"),type:"success",duration:2e3}),t.getList())})}).catch(function(){})},detailClick:function(e){var t=this;this.list.forEach(function(a){a.id===e&&(t.detailVisible=!0,t.detailTitle=a.username+"的用户详情",t.detail=a.introduction)})},resetPwd:function(e){var t=this;this.$confirm(this.$t("table.resetNote"),this.$t("table.note"),{confirmButtonText:this.$t("table.reset"),cancelButtonText:this.$t("table.cancel"),type:"warning"}).then(function(){Object(r.g)({id:e,password:"000000"}).then(function(e){0===e.error_code&&t.$notify({title:t.$t("table.success"),message:t.$t("table.resetSuccess"),type:"success",duration:2e3})})}).catch(function(){})},handleClose:function(){this.resetForm()},resetForm:function(){var e=this;setTimeout(function(){e.$refs.dataForm.resetFields(),e.dataForm={id:null,username:"",password:"",email:"",phone:"",roles:["user"],introduction:""}},500),this.visible=!1,this.saveLoading=!1}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user"},[a("div",{staticClass:"dataForm"},[a("el-dialog",{attrs:{title:0===e.operate?e.$t("user.createUser"):e.$t("user.updateUser"),visible:e.visible,closeOnClickModal:!1,beforeClose:e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.rules,labelWidth:"150px"}},[a("el-form-item",{attrs:{label:e.$t("user.username"),prop:"username"}},[a("el-input",{model:{value:e.dataForm.username,callback:function(t){e.$set(e.dataForm,"username",t)},expression:"dataForm.username"}})],1),e._v(" "),0===e.operate?a("el-form-item",{attrs:{label:e.$t("user.password"),prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.dataForm.password,callback:function(t){e.$set(e.dataForm,"password",t)},expression:"dataForm.password"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.$t("user.email"),prop:"email"}},[a("el-input",{model:{value:e.dataForm.email,callback:function(t){e.$set(e.dataForm,"email",t)},expression:"dataForm.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("user.phone"),prop:"phone"}},[a("el-input",{model:{value:e.dataForm.phone,callback:function(t){e.$set(e.dataForm,"phone",t)},expression:"dataForm.phone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("user.roles"),prop:"roles"}},[a("el-radio-group",{model:{value:e.dataForm.roles[0],callback:function(t){e.$set(e.dataForm.roles,0,t)},expression:"dataForm.roles[0]"}},[a("el-radio",{attrs:{label:"admin"}},[e._v(e._s(e.$t("user.admin")))]),e._v(" "),a("el-radio",{attrs:{label:"user"}},[e._v(e._s(e.$t("user.user")))])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("user.introduction"),prop:"introduction"}},[a("el-input",{attrs:{type:"textarea",placeholder:e.$t("user.enterIntro"),rows:4},model:{value:e.dataForm.introduction,callback:function(t){e.$set(e.dataForm,"introduction",t)},expression:"dataForm.introduction"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.saveForm}},[e._v(e._s(e.$t("table.save")))]),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:e.resetForm}},[e._v(e._s(e.$t("table.cancel")))])],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.detailTitle,visible:e.detailVisible},on:{"update:visible":function(t){e.detailVisible=t}}},[a("p",[e._v(e._s(e.detail))])]),e._v(" "),a("div",{staticClass:"title"},[a("h2",[e._v(e._s(e.generateTitle("users"))+" "),a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(e.$t("user.superAdmin"))+" ")])],1),e._v(" "),a("div",{staticClass:"search"},[a("el-input",{attrs:{placeholder:e.$t("user.search"),title:e.$t("user.search"),prefixIcon:"el-icon-search",clearable:""},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.handleFilter(t)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v(e._s(e.$t("table.search")))]),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-download",loading:e.$store.getters.downloadLoading},on:{click:function(t){e.handleDownload(e.list[0],e.list,e.$t("title")+"-"+e.generateTitle("users"))}}},[e._v(e._s(e.$t("table.export")))])],1),e._v(" "),e.checkRole()?a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleCreate}},[e._v(e._s(e.$t("table.add")))]):e._e()],1),e._v(" "),a("main",{staticClass:"tableLists"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.currentTableLists,border:""}},[a("el-table-column",{attrs:{prop:"username",label:e.$t("user.username")}}),e._v(" "),a("el-table-column",{attrs:{prop:"email",label:e.$t("user.email"),"min-width":"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:e.$t("user.phone")}}),e._v(" "),a("el-table-column",{attrs:{prop:"roles",label:e.$t("user.roles")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e._f("rolesFilter")(t.row.roles)}},[e._v(e._s("admin"===t.row.roles[0]?e.$t("user.admin"):e.$t("user.user")))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"introduction",label:e.$t("user.introduction")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{on:{click:function(a){e.detailClick(t.row.id)}}},[e._v(e._s(e.$t("user.detail")))])]}}])}),e._v(" "),e.checkRole()?a("el-table-column",{attrs:{label:e.$t("user.actions"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return"admin"!==t.row.username?[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(a){e.editRow(t.row.id)}}},[e._v(e._s(e.$t("table.edit")))]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},nativeOn:{click:function(a){a.preventDefault(),e.deleteRow(t.row.id)}}},[e._v(e._s(e.$t("table.delete")))]),e._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},nativeOn:{click:function(a){a.preventDefault(),e.resetPwd(t.row.id)}}},[e._v(e._s(e.$t("table.resetPwd")))])]:void 0}}])}):e._e()],1)],1),e._v(" "),a("div",{staticClass:"page"},[a("el-pagination",{attrs:{background:"","current-page":e.listQuery.page,"page-sizes":[10,20,50,100],"page-size":e.listQuery.limit,layout:"total,sizes,prev,pager,next,jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.listQuery,"page",t)}}})],1)],1)},staticRenderFns:[]};var n=a("X4nt")(i,l,!1,function(e){a("e+ax")},null,null);t.default=n.exports}});
//# sourceMappingURL=22.23161304f618da3d9311.js.map