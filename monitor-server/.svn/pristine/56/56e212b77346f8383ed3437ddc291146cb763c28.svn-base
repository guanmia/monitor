webpackJsonp([22],{NeaV:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("HzJ8"),i=a.n(o),r=a("viKb"),n=a("07y0"),l={name:"region",components:{},data:function(){return{list:[],total:null,locationList:[],dataForm:{id:null,regionName:"",location:[],location_id:null,dbIp:"",dbPort:"",msIp:"",msPort:"",status:1},visible:!1,regionOptions:[],editIndex:0,operate:0,loading:!0,saveLoading:!1,search:"",listQuery:{page:1,limit:20},rules:{id:[{required:!0,message:this.$t("region.idMsg"),trigger:"blur"},{validator:r.a.idRule,trigger:"blur"}],regionName:[{required:!0,message:this.$t("region.regionNameMsg"),trigger:"blur"}],location:[{required:!0,message:this.$t("region.locationMsg"),trigger:"blur"}],dbIp:[{required:!0,message:this.$t("region.dbIpMsg"),trigger:"blur"},{validator:r.a.ipRule,trigger:"blur"}],dbPort:[{required:!0,message:this.$t("region.dbPortMsg"),trigger:"blur"},{validator:r.a.portRule,trigger:"blur"}],msIp:[{required:!0,message:this.$t("region.msIpMsg"),trigger:"blur"},{validator:r.a.ipRule,trigger:"blur"}],msPort:[{required:!0,message:this.$t("region.msPortMsg"),trigger:"blur"},{validator:r.a.portRule,trigger:"blur"}]}}},directives:{numberOnly:{bind:function(t){this.handler=function(){t.value=t.value.replace(/\D+/,"")},t.addEventListener("input",t.handler)},unbind:function(t){t.removeEventListener("input",t.handler)}}},filters:{statusFilter:function(t){return{1:"success",2:"warning",3:"danger"}[t]},statusFilter1:function(t){return{1:"使用",2:"维护",3:"停用"}[t]}},created:function(){this.getList()},methods:{getLocations:function(t){var e=!0,a=!1,o=void 0;try{for(var r,n=i()(t);!(e=(r=n.next()).done);e=!0){var l=r.value,s=[],c=!0,d=!1,u=void 0;try{for(var m,g=i()(l.children);!(c=(m=g.next()).done);c=!0){var v=m.value,p=[],b=!0,f=!1,h=void 0;try{for(var _,$=i()(v.children);!(b=(_=$.next()).done);b=!0){var y=_.value;p.push({value:y.location_id,label:y.location})}}catch(t){f=!0,h=t}finally{try{!b&&$.return&&$.return()}finally{if(f)throw h}}s.push({value:v.location_id,label:v.location})}}catch(t){d=!0,u=t}finally{try{!c&&g.return&&g.return()}finally{if(d)throw u}}this.regionOptions.push({value:l.location_id,label:l.location,children:s})}}catch(t){a=!0,o=t}finally{try{!e&&n.return&&n.return()}finally{if(a)throw o}}},addressChange:function(t){this.dataForm.location=t},getLocation:function(t){var e=this;Object(n.c)().then(function(a){if(0===a.error_code){e.locationList=a.data,e.getLocations(e.locationList);var o=!0,r=!1,n=void 0;try{for(var l,s=i()(t);!(o=(l=s.next()).done);o=!0){var c=l.value;c.location=[];var d=!0,u=!1,m=void 0;try{for(var g,v=i()(e.locationList);!(d=(g=v.next()).done);d=!0){var p=g.value;if(c.location_id===p.location_id)c.location.push({value:p.location_id,label:p.location});else{var b=!0,f=!1,h=void 0;try{for(var _,$=i()(p.children);!(b=(_=$.next()).done);b=!0){var y=_.value;if(c.location_id===y.location_id)c.location.push({value:p.location_id,label:p.location},{value:y.location_id,label:y.location});else{var F=!0,w=!1,P=void 0;try{for(var k,x=i()(y.children);!(F=(k=x.next()).done);F=!0){var I=k.value;c.location_id===I.location_id&&c.location.push({value:p.location_id,label:p.location},{value:y.location_id,label:y.location},{value:I.location_id,label:I.location})}}catch(t){w=!0,P=t}finally{try{!F&&x.return&&x.return()}finally{if(w)throw P}}}}}catch(t){f=!0,h=t}finally{try{!b&&$.return&&$.return()}finally{if(f)throw h}}}}}catch(t){u=!0,m=t}finally{try{!d&&v.return&&v.return()}finally{if(u)throw m}}}}catch(t){r=!0,n=t}finally{try{!o&&s.return&&s.return()}finally{if(r)throw n}}e.list=t}})},getList:function(){var t=this;if(this.loading=!0,""!==this.search){var e=this.search.split(" ");this.listQuery.searchkeys.regionName=e}Object(n.e)(this.listQuery).then(function(e){if(0===e.error_code){var a=e.data.results;t.getLocation(a),t.total=e.data.total,t.loading=!1}})},handleFilter:function(){this.listQuery.page=1,this.getList()},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},handleCreate:function(){this.visible=!0,this.operate=0},editRow:function(t){var e=this;this.editIndex=t,Object(n.d)({id:t}).then(function(t){0===t.error_code&&(e.dataForm=t.data,e.dataForm.location=[],e.list.forEach(function(t){e.dataForm.location_id===t.location_id&&t.location.forEach(function(t){e.dataForm.location.push(t.value)})}),console.log(e.dataForm),e.operate=1,e.visible=!0)})},saveForm:function(){var t=this;this.$refs.dataForm.validate(function(e){e&&(t.saveLoading=!0,t.dataForm.location_id=t.dataForm.location[t.dataForm.location.length-1],0===t.operate?Object(n.a)(t.dataForm).then(function(e){0===e.error_code&&(t.$notify({title:t.$t("table.success"),message:t.$t("table.createSuccess"),type:"success",duration:2e3}),t.getList(),t.resetForm())}):1===t.operate&&Object(n.f)(t.dataForm).then(function(e){0===e.error_code&&(t.$notify({title:t.$t("table.success"),message:t.$t("table.updateSuccess"),type:"success",duration:2e3}),t.getList(),t.resetForm())}))})},deleteRow:function(t){var e=this;this.$confirm(this.$t("table.deleteNote"),this.$t("table.note"),{confirmButtonText:this.$t("table.delete"),cancelButtonText:this.$t("table.cancel"),type:"warning"}).then(function(){Object(n.b)({id:t}).then(function(t){0===t.error_code&&(e.$notify({title:e.$t("table.success"),message:e.$t("table.deleteSuccess"),type:"success",duration:2e3}),e.getList())})}).catch(function(){})},handleClose:function(){this.resetForm()},resetForm:function(){var t=this;setTimeout(function(){t.$refs.dataForm.resetFields(),t.dataForm={id:null,regionName:"",location:[],location_id:null,dbIp:"",dbPort:"",msIp:"",msPort:"",status:1}},500),this.visible=!1,this.saveLoading=!1}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"region"},[a("div",{staticClass:"dataForm"},[a("el-dialog",{attrs:{title:0===t.operate?t.$t("region.createRegion"):t.$t("region.updateRegion"),visible:t.visible,closeOnClickModal:!1,beforeClose:t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{ref:"dataForm",attrs:{model:t.dataForm,rules:t.rules,labelWidth:"150px"}},[a("el-form-item",{attrs:{label:t.$t("region.id"),prop:"id"}},[0===t.operate?a("el-input",{model:{value:t.dataForm.id,callback:function(e){t.$set(t.dataForm,"id",e)},expression:"dataForm.id"}}):a("p",[t._v(t._s(t.dataForm.id))])],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("region.regionName"),prop:"regionName"}},[a("el-input",{model:{value:t.dataForm.regionName,callback:function(e){t.$set(t.dataForm,"regionName",e)},expression:"dataForm.regionName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("region.location"),prop:"location"}},[a("el-cascader",{attrs:{options:t.regionOptions,clearable:""},on:{change:t.addressChange},model:{value:t.dataForm.location,callback:function(e){t.$set(t.dataForm,"location",e)},expression:"dataForm.location"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("region.dbIp"),prop:"dbIp"}},[a("el-input",{model:{value:t.dataForm.dbIp,callback:function(e){t.$set(t.dataForm,"dbIp",e)},expression:"dataForm.dbIp"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("region.dbPort"),prop:"dbPort"}},[a("el-input",{model:{value:t.dataForm.dbPort,callback:function(e){t.$set(t.dataForm,"dbPort",e)},expression:"dataForm.dbPort"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("region.msIp"),prop:"msIp"}},[a("el-input",{model:{value:t.dataForm.msIp,callback:function(e){t.$set(t.dataForm,"msIp",e)},expression:"dataForm.msIp"}})],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("region.msPort"),prop:"msPort"}},[a("el-input",{model:{value:t.dataForm.msPort,callback:function(e){t.$set(t.dataForm,"msPort",e)},expression:"dataForm.msPort"}})],1),t._v(" "),1===t.operate?a("el-form-item",{attrs:{label:t.$t("region.status"),prop:"status"}},[a("el-radio-group",{model:{value:t.dataForm.status,callback:function(e){t.$set(t.dataForm,"status",e)},expression:"dataForm.status"}},[a("el-radio",{attrs:{label:1}},[t._v(t._s(t.$t("region.use")))]),t._v(" "),a("el-radio",{attrs:{label:2}},[t._v(t._s(t.$t("region.maintain")))]),t._v(" "),a("el-radio",{attrs:{label:3}},[t._v(t._s(t.$t("region.nonuse")))])],1)],1):t._e(),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:t.saveLoading},on:{click:t.saveForm}},[t._v(t._s(t.$t("table.save")))]),t._v(" "),a("el-button",{attrs:{type:"info"},on:{click:t.resetForm}},[t._v(t._s(t.$t("table.cancel")))])],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"title"},[a("h2",[t._v(t._s(t.generateTitle("region")))]),t._v(" "),a("div",{staticClass:"search"},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-download",loading:t.$store.getters.downloadLoading},on:{click:function(e){t.handleDownload(t.list[0],t.list,t.$t("title")+"-"+t.generateTitle("region"))}}},[t._v(t._s(t.$t("table.export")))])],1),t._v(" "),this.checkRole()?a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleCreate}},[t._v(t._s(t.$t("table.add")))]):t._e()],1),t._v(" "),a("main",{staticClass:"lists"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[a("el-table-column",{attrs:{prop:"id",label:t.$t("region.id"),width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"regionName",label:t.$t("region.regionName")}}),t._v(" "),a("el-table-column",{attrs:{prop:"location",label:t.$t("region.location")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.location[0]?e.row.location[0].label:"")+" \n                "+t._s(e.row.location[1]?e.row.location[1].label:"")+" \n                "+t._s(e.row.location[2]?e.row.location[2].label:"")+" \n              ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"dbIp",label:t.$t("region.dbIp")}}),t._v(" "),a("el-table-column",{attrs:{prop:"dbPort",label:t.$t("region.dbPort")}}),t._v(" "),a("el-table-column",{attrs:{prop:"msIp",label:t.$t("region.msIp")}}),t._v(" "),a("el-table-column",{attrs:{prop:"msPort",label:t.$t("region.msPort")}}),t._v(" "),a("el-table-column",{attrs:{prop:"clientNum",label:t.$t("region.clientNum")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("router-link",{attrs:{to:"/center/client"}},[a("el-button",{attrs:{type:"text"}},[t._v(t._s(e.row.clientNum))])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:t.$t("region.status")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t._f("statusFilter")(e.row.status)}},[t._v(t._s(1===e.row.status?t.$t("region.use"):2===e.row.status?t.$t("region.maintain"):t.$t("region.nonuse")))])]}}])}),t._v(" "),t.checkRole()?a("el-table-column",{attrs:{label:t.$t("region.actions"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(a){t.editRow(e.row.id)}}},[t._v(t._s(t.$t("table.edit")))]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},nativeOn:{click:function(a){a.preventDefault(),t.deleteRow(e.row.id)}}},[t._v(t._s(t.$t("table.delete")))])]}}])}):t._e()],1)],1),t._v(" "),a("div",{staticClass:"page"},[a("el-pagination",{attrs:{background:"","current-page":t.listQuery.page,"page-sizes":[10,20,50,100],"page-size":t.listQuery.limit,layout:"total,sizes,prev,pager,next,jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.$set(t.listQuery,"page",e)}}})],1)])},staticRenderFns:[]};var c=a("X4nt")(l,s,!1,function(t){a("h5PQ")},null,null);e.default=c.exports},h5PQ:function(t,e){}});
//# sourceMappingURL=22.8c34c1f40b9229a4906f.js.map